<?xml version="1.0" encoding="UTF-8" ?>

<project name="testCA" default="all" basedir=".">  

    <property name="ca.src.dir" value="/home/archermind/jenkins/tmp_src/ca" />
    <property name="compile.dir" value="/home/archermind/jenkins/public/compile/ca/nutlet_helloworld" />
    <!-- <property name="compile.dir" value="${ca_path}" /> -->
    <property name="compile.ca.dir" value="${compile.dir}/jni/host" />
    <property name="ca.generate.dir" value="${compile.dir}/libs/arm64-v8a" />
    <property name="dest.dir" value="dest" />
    <property name="ca.dest.dir" value="${dest.dir}/ca" />

    


    <target name="clean" depends="makeclean"  description="removes all generated files">
        <echo message="删除上次生成目录和文件并新建目标目录 "/>

        <delete verbose="true" includeemptydirs="false">
            <fileset dir="${compile.ca.dir}">
                <include name="**/**"/>
            </fileset>
        </delete>
        <delete verbose="true" includeemptydirs="false">
            <fileset dir="${ca.generate.dir}">
                <include name="**/**"/>
            </fileset>
        </delete>

        <delete dir="${ca.dest.dir}"/>
        

        <mkdir dir="${ca.dest.dir}" />
    </target>


    <target name="makeclean" >
        <echo message="调用make clean 命令清除上次生成的文件"/>
        <exec executable="/bin/sh">
            <arg line="-c &quot; cd '${compile.dir}' &amp;&amp; ndk-build clean &quot;"/>
        </exec>
    </target>

    <target name="copy.ca.src" depends="clean" description="copy ca files from svn.ca to compile.ca ">
        <echo message="把SVN check out 的代码复制到编译目录"/>
        <copy todir="${compile.ca.dir}" overwrite="true">
            <fileset dir="${ca.src.dir}">
                <include name="**.c"/>
                <include name="**.h"/>
            </fileset>
        </copy>
    </target>

    <target name="compile.ca" depends="copy.ca.src">
        <echo message="调用ndk-build命令编译ca"/>
        <exec executable="/bin/sh">
            <arg line="-c &quot; cd '${compile.dir}' &amp;&amp; ndk-build &quot;"/>
        </exec>
    </target>

    <target name="copy.ca" depends="compile.ca"  description="copy .ca files to dest.dir">
        <copy todir="${ca.dest.dir}" overwrite="true">
            <fileset dir="${ca.generate.dir}">
                <exclude name="**.s"/>
                <!-- <include name="helloworld"/> -->
            </fileset>
        </copy>
    </target>



    <target name="all" depends="copy.ca" description="clean, compile"/>

</project>

